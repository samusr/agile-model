const Model = require("../config/objection");

module.exports = class <%= relation.sourceModel.modelName %> extends Model {
    static get tableName() {
        return "<%= relation.sourceModel.tablename %>";
    }<% if (relation.graphRelations && relation.graphRelations.length > 0) { %>
    
    static get relationMappings() {
        return {<% for(let graph of relation.graphRelations) { for(let dependencyModel of graph.dependencyModels) { if (graph.relationType.type == "HAS_MANY") { %>
            <%= dependencyModel.tablename %>: {
                relation: Model.HasManyRelation,
                modelClass: require("./<%= dependencyModel.modelFilename %>"),
                join: {
                    from: "<%= relation.sourceModel.tablename %>.id",
                    to: "<%= dependencyModel.tablename %>.<%= relation.sourceModel.modelName.toLowerCase() %>_id"
                }
            },<% } else if (graph.relationType.type == "HAS_ONE") { %>
            <%= dependencyModel.modelFilename.split(".")[0].replace(/-/g, "_") %>: {
                relation: Model.HasOneRelation,
                modelClass: require("./<%= dependencyModel.modelFilename %>"),
                join: {
                    from: "<%= relation.sourceModel.tablename %>.id",
                    to: "<%= dependencyModel.tablename %>.<%= relation.sourceModel.modelName.toLowerCase() %>_id"
                }
            },<% } else if (graph.relationType.type == "BELONGS_TO_ONE") { %>
            <%= dependencyModel.modelFilename.split(".")[0].replace(/-/g, "_") %>: {
                relation: Model.BelongsToOneRelation,
                modelClass: require("./<%= dependencyModel.modelFilename %>"),
                join: {
                    from: "<%= relation.sourceModel.tablename %>.<%= dependencyModel.modelName.toLowerCase() %>_id",
                    to: "<%= dependencyModel.tablename %>.id"
                }
            },<% }}} %>
        };
    }<% } %>
};
